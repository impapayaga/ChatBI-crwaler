# 前端环境变量配置说明

## 🎯 问题说明

由于现在有两个后端服务，前端需要配置两个不同的API地址：

1. **ChatBI后端** (端口11434) - 智能问答、文件管理、数据集管理
2. **Crawler适配后端** (端口8001) - 数据爬取管理

## 📝 需要修改的文件

### 1. 创建前端.env文件

**文件位置**: `C:\Users\KC\Desktop\POC\Chat-BI-main\frontend\.env`

```env
# ChatBI Frontend Environment Variables
# ===========================================

# ChatBI后端API配置 (智能问答、文件管理、数据集等)
VITE_API_BASE_URL=http://localhost:11434

# Crawler适配后端API配置 (数据爬取管理)
VITE_CRAWLER_API_BASE_URL=http://localhost:8001

# 其他环境变量
# VITE_APP_TITLE=ChatBI
# VITE_APP_VERSION=1.0.0
```

### 2. 已修改的文件

#### `env.d.ts` - TypeScript类型定义
```typescript
interface ImportMetaEnv {
    readonly VITE_API_BASE_URL: string
    readonly VITE_CRAWLER_API_BASE_URL: string
    // 你可以在这里添加更多的环境变量
}
```

#### `WebScraperManager.vue` - 数据爬取管理组件
```typescript
// 使用Crawler适配API (端口8001)
const API_BASE_URL = import.meta.env.VITE_CRAWLER_API_BASE_URL || 'http://localhost:8001'
```

## 🔧 配置步骤

### 步骤1: 创建.env文件

在 `C:\Users\KC\Desktop\POC\Chat-BI-main\frontend\` 目录下创建 `.env` 文件：

```bash
# 进入前端目录
cd C:\Users\KC\Desktop\POC\Chat-BI-main\frontend

# 创建.env文件
echo # ChatBI Frontend Environment Variables > .env
echo # =========================================== >> .env
echo. >> .env
echo # ChatBI后端API配置 (智能问答、文件管理、数据集等) >> .env
echo VITE_API_BASE_URL=http://localhost:11434 >> .env
echo. >> .env
echo # Crawler适配后端API配置 (数据爬取管理) >> .env
echo VITE_CRAWLER_API_BASE_URL=http://localhost:8001 >> .env
echo. >> .env
echo # 其他环境变量 >> .env
echo # VITE_APP_TITLE=ChatBI >> .env
echo # VITE_APP_VERSION=1.0.0 >> .env
```

### 步骤2: 重启前端服务

```bash
# 停止前端服务 (Ctrl+C)
# 重新启动前端服务
cd C:\Users\KC\Desktop\POC\Chat-BI-main\frontend
pnpm dev
```

## 🧪 验证配置

### 检查环境变量是否正确加载

在浏览器开发者工具的控制台中运行：

```javascript
// 检查ChatBI后端API配置
console.log('ChatBI API:', import.meta.env.VITE_API_BASE_URL)

// 检查Crawler API配置
console.log('Crawler API:', import.meta.env.VITE_CRAWLER_API_BASE_URL)
```

### 测试API调用

```javascript
// 测试ChatBI后端API
fetch(import.meta.env.VITE_API_BASE_URL + '/api/ai-model-configs?user_id=1')
  .then(response => response.json())
  .then(data => console.log('ChatBI API正常:', data))

// 测试Crawler适配API
fetch(import.meta.env.VITE_CRAWLER_API_BASE_URL + '/api/scraper/sources')
  .then(response => response.json())
  .then(data => console.log('Crawler API正常:', data))
```

## 📊 API调用映射

| 前端功能 | 使用的API地址 | 后端服务 |
|---------|-------------|---------|
| 智能问答 | `VITE_API_BASE_URL` | ChatBI后端 (11434) |
| 文件上传 | `VITE_API_BASE_URL` | ChatBI后端 (11434) |
| 数据集管理 | `VITE_API_BASE_URL` | ChatBI后端 (11434) |
| 模型配置 | `VITE_API_BASE_URL` | ChatBI后端 (11434) |
| 数据爬取管理 | `VITE_CRAWLER_API_BASE_URL` | Crawler适配 (8001) |

## 🐛 常见问题

### 问题1: 前端无法访问数据爬取管理功能

**症状**: 数据爬取管理页面显示"加载失败"或"网络错误"

**原因**: 前端没有正确配置`VITE_CRAWLER_API_BASE_URL`

**解决方案**:
1. 检查`.env`文件是否存在
2. 确认`VITE_CRAWLER_API_BASE_URL=http://localhost:8001`
3. 重启前端服务

### 问题2: 智能问答功能无法使用

**症状**: 智能问答显示"无法创建对话"

**原因**: 前端没有正确配置`VITE_API_BASE_URL`

**解决方案**:
1. 检查`.env`文件中的`VITE_API_BASE_URL=http://localhost:11434`
2. 确认ChatBI后端服务正在运行
3. 重启前端服务

### 问题3: 环境变量不生效

**症状**: 修改`.env`文件后，前端仍然使用旧的配置

**解决方案**:
1. 完全停止前端服务 (Ctrl+C)
2. 删除`node_modules/.vite`缓存目录
3. 重新启动前端服务

## ✅ 配置完成检查清单

- [ ] 创建了`frontend/.env`文件
- [ ] 配置了`VITE_API_BASE_URL=http://localhost:11434`
- [ ] 配置了`VITE_CRAWLER_API_BASE_URL=http://localhost:8001`
- [ ] 修改了`env.d.ts`类型定义
- [ ] 修改了`WebScraperManager.vue`组件
- [ ] 重启了前端服务
- [ ] 测试了智能问答功能
- [ ] 测试了数据爬取管理功能

## 🎉 完成！

配置完成后，前端将能够正确调用两个不同的后端服务：
- 智能问答、文件管理 → ChatBI后端 (11434)
- 数据爬取管理 → Crawler适配后端 (8001)
