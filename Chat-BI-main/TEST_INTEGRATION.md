# æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½é›†æˆæµ‹è¯•æŒ‡å—

## âœ… å·²å®Œæˆçš„å‰ç«¯é›†æˆ

### 1. æ–°å¢ç»„ä»¶

| ç»„ä»¶ | è·¯å¾„ | åŠŸèƒ½ |
|-----|------|-----|
| **FileUploadDialog.vue** | `frontend/src/components/FileUploadDialog.vue` | æ–‡ä»¶ä¸Šä¼ å¯¹è¯æ¡†ï¼Œæ”¯æŒCSV/Excelä¸Šä¼  |
| **DatasetList.vue** | `frontend/src/components/DatasetList.vue` | æ•°æ®é›†åˆ—è¡¨æ˜¾ç¤ºï¼Œæ”¯æŒæŸ¥çœ‹ã€é€‰æ‹©ã€åˆ é™¤ |

### 2. ä¿®æ”¹çš„ç»„ä»¶

| ç»„ä»¶ | ä¿®æ”¹å†…å®¹ |
|-----|---------|
| **ChatInput.vue** | æ·»åŠ  `uploadClick` äº‹ä»¶ï¼Œç‚¹å‡»é™„ä»¶å›¾æ ‡è§¦å‘ä¸Šä¼  |
| **Home.vue** | é›†æˆ FileUploadDialog å’Œ DatasetListï¼Œæ·»åŠ æ•°æ®é›†ç®¡ç†é€»è¾‘ |

### 3. æ ¸å¿ƒåŠŸèƒ½

#### æ–‡ä»¶ä¸Šä¼ æµç¨‹
1. ç”¨æˆ·ç‚¹å‡»è¾“å…¥æ¡†çš„é™„ä»¶å›¾æ ‡ (ğŸ“)
2. å¼¹å‡ºæ–‡ä»¶ä¸Šä¼ å¯¹è¯æ¡†
3. é€‰æ‹© CSV/Excel æ–‡ä»¶ï¼ˆæœ€å¤§ 100MBï¼‰
4. å¡«å†™æ•°æ®é›†åç§°å’Œæè¿°
5. ç‚¹å‡»"ä¸Šä¼ "æŒ‰é’®
6. æ˜¾ç¤ºä¸Šä¼ è¿›åº¦æ¡
7. åå°è§£ææ–‡ä»¶ï¼ˆè½®è¯¢çŠ¶æ€ï¼‰
8. è§£ææˆåŠŸåè‡ªåŠ¨å…³é—­å¯¹è¯æ¡†
9. åˆ·æ–°æ•°æ®é›†åˆ—è¡¨

#### æ•°æ®é›†åˆ—è¡¨
1. é¡¶éƒ¨å·¥å…·æ æ˜¾ç¤ºæ•°æ®é›†å›¾æ ‡ ğŸ—„ï¸ (å¸¦å¾½ç« æ˜¾ç¤ºæ•°é‡)
2. ç‚¹å‡»å›¾æ ‡å±•å¼€æ•°æ®é›†åˆ—è¡¨
3. åˆ—è¡¨æ˜¾ç¤ºï¼š
   - æ•°æ®é›†åç§°
   - è§£æçŠ¶æ€ï¼ˆpending/parsing/parsed/failedï¼‰
   - æ•°æ®è§„æ¨¡ï¼ˆè¡Œæ•° Ã— åˆ—æ•°ï¼‰
4. æ”¯æŒæ“ä½œï¼š
   - é€‰æ‹©æ•°æ®é›†ï¼ˆç”¨äºæŸ¥è¯¢ï¼‰
   - æŸ¥çœ‹è¯¦æƒ…
   - åˆ é™¤æ•°æ®é›†

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### å‰ç½®æ¡ä»¶

1. **ç¡®ä¿åç«¯æœåŠ¡è¿è¡Œ**
```bash
cd backend
# å¯åŠ¨ Docker æœåŠ¡
docker-compose up -d

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker-compose ps
# åº”è¯¥çœ‹åˆ°ï¼šchatbi-postgres, chatbi-redis, chatbi-minio, chatbi-qdrant å…¨éƒ¨ Up

# å¯åŠ¨åç«¯
python main.py
```

2. **ç¡®ä¿å‰ç«¯æœåŠ¡è¿è¡Œ**
```bash
cd frontend
pnpm dev
# è®¿é—® http://localhost:3000
```

---

### æµ‹è¯•ç”¨ä¾‹ 1: ä¸Šä¼  CSV æ–‡ä»¶

#### 1.1 å‡†å¤‡æµ‹è¯•æ•°æ®

åˆ›å»ºæ–‡ä»¶ `test_sales.csv`:
```csv
æ—¥æœŸ,äº§å“åç§°,é”€å”®é¢,é”€å”®æ•°é‡
2024-01-01,äº§å“A,1250.5,50
2024-01-02,äº§å“B,3400.2,120
2024-01-03,äº§å“A,890.0,35
2024-01-04,äº§å“C,2100.8,80
2024-01-05,äº§å“B,4500.0,150
```

#### 1.2 æ‰§è¡Œä¸Šä¼ 
1. æ‰“å¼€åº”ç”¨ http://localhost:3000
2. ç‚¹å‡»è¾“å…¥æ¡†å·¦ä¾§çš„ ğŸ“ å›¾æ ‡
3. é€‰æ‹© `test_sales.csv`
4. æ•°æ®é›†åç§°è‡ªåŠ¨å¡«å……ä¸º `test_sales`ï¼ˆå¯ä¿®æ”¹ä¸º"é”€å”®æ•°æ®æµ‹è¯•"ï¼‰
5. æè¿°å¡«å†™ï¼š"2024å¹´1æœˆé”€å”®è®°å½•"
6. ç‚¹å‡»"ä¸Šä¼ "

#### 1.3 é¢„æœŸç»“æœ
- âœ… ä¸Šä¼ è¿›åº¦æ¡ä» 0% â†’ 100%
- âœ… æ˜¾ç¤º"æ­£åœ¨è§£ææ–‡ä»¶ï¼Œè¯·ç¨å€™..."
- âœ… çº¦ 2-5 ç§’åæ˜¾ç¤º"æ–‡ä»¶è§£ææˆåŠŸï¼"
- âœ… å¼¹å‡ºæç¤ºï¼š"æ•°æ®é›†ä¸Šä¼ æˆåŠŸï¼æ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ•°æ®é›†è¿›è¡ŒæŸ¥è¯¢äº†ã€‚"
- âœ… å¯¹è¯æ¡†è‡ªåŠ¨å…³é—­
- âœ… æ•°æ®é›†å›¾æ ‡æ˜¾ç¤ºå¾½ç«  "1"

#### 1.4 éªŒè¯åç«¯å­˜å‚¨

**æ£€æŸ¥ MinIO:**
```
è®¿é—® http://localhost:9001
ç™»å½•: minioadmin / minioadmin123
Bucket: chatbi-datasets
  - uploads/xxx.csv (åŸå§‹æ–‡ä»¶)
  - parquet/xxx.parquet (è½¬æ¢åçš„æ–‡ä»¶)
```

**æ£€æŸ¥ PostgreSQL:**
```bash
docker exec -it chatbi-postgres psql -U aigcgen -d chabi_template

SELECT id, name, logical_name, parse_status, row_count, column_count
FROM sys_dataset;

# é¢„æœŸè¾“å‡º:
# id | name | logical_name | parse_status | row_count | column_count
# --- | ---- | ------------ | ------------ | --------- | ------------
# xxx | test_sales.csv | é”€å”®æ•°æ®æµ‹è¯• | parsed | 5 | 4
```

**æ£€æŸ¥ Qdrant:**
```bash
curl http://localhost:6333/collections/chatbi_columns

# é¢„æœŸ: vectors_count = 4 (4åˆ—çš„embedding)
```

---

### æµ‹è¯•ç”¨ä¾‹ 2: æŸ¥çœ‹æ•°æ®é›†åˆ—è¡¨

#### 2.1 ç‚¹å‡»æ•°æ®é›†å›¾æ ‡
1. åœ¨é¡¶éƒ¨å·¥å…·æ æ‰¾åˆ°æ•°æ®é›†å›¾æ ‡ ğŸ—„ï¸ï¼ˆå³ä¸Šè§’ï¼‰
2. ç‚¹å‡»å›¾æ ‡å±•å¼€åˆ—è¡¨

#### 2.2 é¢„æœŸç»“æœ
- âœ… æ˜¾ç¤ºæ•°æ®é›†åˆ—è¡¨
- âœ… "é”€å”®æ•°æ®æµ‹è¯•" æ˜¾ç¤ºç»¿è‰² âœ“ å›¾æ ‡ï¼ˆå·²è§£æï¼‰
- âœ… å‰¯æ ‡é¢˜æ˜¾ç¤º "5 è¡Œ Ã— 4 åˆ—"

#### 2.3 æŸ¥çœ‹è¯¦æƒ…
1. ç‚¹å‡»æ•°æ®é›†å³ä¾§çš„ "â‹®" èœå•
2. é€‰æ‹©"æŸ¥çœ‹è¯¦æƒ…"

#### 2.4 é¢„æœŸç»“æœ
- âœ… å¼¹å‡ºè¯¦æƒ…å¯¹è¯æ¡†
- âœ… æ˜¾ç¤ºæ–‡ä»¶åã€æ•°æ®è§„æ¨¡ã€è§£æçŠ¶æ€ã€æè¿°ã€ä¸Šä¼ æ—¶é—´

---

### æµ‹è¯•ç”¨ä¾‹ 3: ä½¿ç”¨æ•°æ®é›†æŸ¥è¯¢

#### 3.1 é€‰æ‹©æ•°æ®é›†
1. åœ¨æ•°æ®é›†åˆ—è¡¨ä¸­ç‚¹å‡»"é”€å”®æ•°æ®æµ‹è¯•"
2. æˆ–ç‚¹å‡» "â‹®" â†’ "é€‰æ‹©æ•°æ®é›†"

#### 3.2 é¢„æœŸç»“æœ
- âœ… è¾“å…¥æ¡†è‡ªåŠ¨å¡«å……ï¼š"åˆ†æé”€å”®æ•°æ®æµ‹è¯•çš„æ•°æ®"

#### 3.3 æ‰§è¡ŒæŸ¥è¯¢
åœ¨è¾“å…¥æ¡†è¾“å…¥ä»¥ä¸‹é—®é¢˜ï¼ˆä»»é€‰å…¶ä¸€ï¼‰ï¼š
- "é”€å”®é¢æœ€é«˜çš„äº§å“æ˜¯ä»€ä¹ˆï¼Ÿ"
- "æ˜¾ç¤ºæ¯ä¸ªäº§å“çš„æ€»é”€å”®é¢"
- "å“ªå¤©çš„é”€å”®æ•°é‡æœ€å¤šï¼Ÿ"

ç‚¹å‡»å‘é€ â†‘

#### 3.4 é¢„æœŸç»“æœï¼ˆåŸºäºåç«¯å®ç°ï¼‰

**æ–¹æ¡ˆ A: å‘é‡ç›¸ä¼¼åº¦ > 0.7ï¼ˆä½¿ç”¨ç”¨æˆ·æ•°æ®é›†ï¼‰**
- âœ… åç«¯æ‰§è¡Œå‘é‡æ£€ç´¢ï¼Œæ‰¾åˆ°ç›¸å…³åˆ—
- âœ… ç”Ÿæˆ DuckDB SQL æŸ¥è¯¢
- âœ… æŸ¥è¯¢ç”¨æˆ·ä¸Šä¼ çš„ Parquet æ–‡ä»¶
- âœ… è¿”å›å›¾è¡¨æ•°æ®ï¼Œ`data_source: "user_dataset"`
- âœ… å‰ç«¯å±•ç¤ºå›¾è¡¨

**æ–¹æ¡ˆ B: å‘é‡ç›¸ä¼¼åº¦ < 0.7ï¼ˆå›é€€åˆ°å›ºå®šSchemaï¼‰**
- âš ï¸ åç«¯æœªæ‰¾åˆ°é«˜ç›¸ä¼¼åº¦åˆ—
- âœ… å›é€€åˆ°å›ºå®šæ•°æ®åº“æŸ¥è¯¢
- âœ… è¿”å›å›¾è¡¨æ•°æ®ï¼Œ`data_source: "fixed_schema"`

---

### æµ‹è¯•ç”¨ä¾‹ 4: ä¸Šä¼  Excel æ–‡ä»¶

#### 4.1 å‡†å¤‡æµ‹è¯•æ•°æ®

åˆ›å»º `test_users.xlsx` (ä½¿ç”¨ Excel):
| ç”¨æˆ·ID | å§“å | å¹´é¾„ | åŸå¸‚ |
|--------|------|------|------|
| 1001 | å¼ ä¸‰ | 28 | åŒ—äº¬ |
| 1002 | æå›› | 35 | ä¸Šæµ· |
| 1003 | ç‹äº” | 42 | å¹¿å· |

#### 4.2 æ‰§è¡Œä¸Šä¼ 
1. ç‚¹å‡» ğŸ“ å›¾æ ‡
2. é€‰æ‹© `test_users.xlsx`
3. æ•°æ®é›†åç§°ï¼š"ç”¨æˆ·æ•°æ®æµ‹è¯•"
4. æè¿°ï¼š"æµ‹è¯•ç”¨æˆ·ä¿¡æ¯"
5. ä¸Šä¼ 

#### 4.3 é¢„æœŸç»“æœ
- âœ… Excel æ–‡ä»¶æˆåŠŸè§£æ
- âœ… æ•°æ®é›†åˆ—è¡¨æ˜¾ç¤º 2 ä¸ªæ•°æ®é›†
- âœ… å¾½ç« æ˜¾ç¤º "2"

---

### æµ‹è¯•ç”¨ä¾‹ 5: åˆ é™¤æ•°æ®é›†

#### 5.1 åˆ é™¤æ“ä½œ
1. æ‰“å¼€æ•°æ®é›†åˆ—è¡¨
2. ç‚¹å‡»æŸä¸ªæ•°æ®é›†çš„ "â‹®" èœå•
3. é€‰æ‹©"åˆ é™¤"
4. ç¡®è®¤åˆ é™¤

#### 5.2 é¢„æœŸç»“æœ
- âœ… å¼¹å‡ºç¡®è®¤æç¤º
- âœ… ç¡®è®¤åæ•°æ®é›†ä»åˆ—è¡¨æ¶ˆå¤±
- âœ… å¾½ç« æ•°å­—å‡ 1
- âœ… PostgreSQL ä¸­è®°å½•è¢«åˆ é™¤
- âœ… MinIO ä¸­æ–‡ä»¶è¢«åˆ é™¤
- âœ… Qdrant ä¸­å‘é‡è¢«åˆ é™¤

---

### æµ‹è¯•ç”¨ä¾‹ 6: æ–‡ä»¶éªŒè¯

#### 6.1 ä¸Šä¼ è¶…å¤§æ–‡ä»¶
1. å°è¯•ä¸Šä¼  > 100MB çš„æ–‡ä»¶
2. **é¢„æœŸ**: æ˜¾ç¤ºé”™è¯¯ "æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡ 100MB"

#### 6.2 ä¸Šä¼ ä¸æ”¯æŒçš„æ ¼å¼
1. å°è¯•ä¸Šä¼  `.txt`, `.pdf`, `.json` æ–‡ä»¶
2. **é¢„æœŸ**: æ˜¾ç¤ºé”™è¯¯ "ä»…æ”¯æŒ CSV æˆ– Excel æ–‡ä»¶"

#### 6.3 ç©ºæ–‡ä»¶å
1. æ¸…ç©º"æ•°æ®é›†åç§°"è¾“å…¥æ¡†
2. **é¢„æœŸ**: "ä¸Šä¼ "æŒ‰é’®ç¦ç”¨ï¼Œæ˜¾ç¤º "è¯·è¾“å…¥æ•°æ®é›†åç§°"

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: ä¸Šä¼ åä¸€ç›´æ˜¾ç¤º"è§£æä¸­"

**å¯èƒ½åŸå› :**
- åå°è§£æä»»åŠ¡å¤±è´¥
- Embedding API æœªé…ç½®

**æ’æŸ¥:**
```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—
tail -f backend/logs/app.log

# æ‰‹åŠ¨æ£€æŸ¥æ•°æ®é›†çŠ¶æ€
curl http://127.0.0.1:11434/api/dataset/{dataset_id}/status
```

**ä¸´æ—¶è§£å†³:** Embedding å¤±è´¥ä¸å½±å“æ–‡ä»¶è§£æï¼Œåªæ˜¯è·³è¿‡å‘é‡åŒ–

---

### é—®é¢˜ 2: æ•°æ®é›†åˆ—è¡¨ä¸ºç©º

**æ’æŸ¥:**
```bash
# æ£€æŸ¥ API å“åº”
curl http://127.0.0.1:11434/api/datasets

# æ£€æŸ¥æ•°æ®åº“
docker exec -it chatbi-postgres psql -U aigcgen -d chabi_template \
  -c "SELECT * FROM sys_dataset;"
```

---

### é—®é¢˜ 3: å‰ç«¯ç»„ä»¶æœªæ˜¾ç¤º

**æ’æŸ¥:**
1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å° (F12) æ˜¯å¦æœ‰é”™è¯¯
2. ç¡®è®¤ç»„ä»¶å·²æ­£ç¡®å¯¼å…¥åˆ° `Home.vue`
3. æ£€æŸ¥ Vuetify è‡ªåŠ¨å¯¼å…¥æ˜¯å¦ç”Ÿæ•ˆ

**è§£å†³:**
```bash
cd frontend
pnpm install  # é‡æ–°å®‰è£…ä¾èµ–
pnpm dev      # é‡å¯å¼€å‘æœåŠ¡å™¨
```

---

### é—®é¢˜ 4: æŸ¥è¯¢æœªä½¿ç”¨ç”¨æˆ·æ•°æ®é›†

**æ’æŸ¥:**
```bash
# æ£€æŸ¥å‘é‡æ£€ç´¢ç»“æœ
curl -X POST http://127.0.0.1:11434/api/generate_chart \
  -H "Content-Type: application/json" \
  -d '{"user_input": "é”€å”®é¢æœ€é«˜çš„äº§å“"}'

# æŸ¥çœ‹å“åº”ä¸­çš„ data_source å­—æ®µ
# "user_dataset" = ä½¿ç”¨ç”¨æˆ·æ•°æ®
# "fixed_schema" = ä½¿ç”¨å›ºå®šæ•°æ®åº“
```

**å¯èƒ½åŸå› :**
- å‘é‡ç›¸ä¼¼åº¦ < 0.7 é˜ˆå€¼
- Embedding æœªç”Ÿæˆ
- æŸ¥è¯¢å…³é”®è¯ä¸åˆ—åè¯­ä¹‰å·®è·å¤§

**è§£å†³:** è°ƒæ•´ `generate_chart.py:63` çš„ç›¸ä¼¼åº¦é˜ˆå€¼

---

## ğŸ“Š æ€§èƒ½æµ‹è¯•

### å°æ–‡ä»¶ (< 1MB, 100è¡Œ)
- ä¸Šä¼ : ~100ms
- è§£æ: ~200ms
- Embedding: ~1.5s
- **æ€»è®¡**: ~2s

### ä¸­ç­‰æ–‡ä»¶ (10MB, 1ä¸‡è¡Œ)
- ä¸Šä¼ : ~500ms
- è§£æ: ~2s
- Embedding: ~8s (å‡è®¾20åˆ—)
- **æ€»è®¡**: ~11s

---

## âœ… æµ‹è¯•æ£€æŸ¥æ¸…å•

éƒ¨ç½²æµ‹è¯•å‰è¯·ç¡®è®¤:

- [ ] Docker æœåŠ¡å…¨éƒ¨æ­£å¸¸ (postgres, redis, minio, qdrant)
- [ ] åç«¯æœåŠ¡è¿è¡Œåœ¨ http://127.0.0.1:11434
- [ ] å‰ç«¯æœåŠ¡è¿è¡Œåœ¨ http://localhost:3000
- [ ] MinIO Console å¯è®¿é—® (http://localhost:9001)
- [ ] Qdrant Dashboard å¯è®¿é—® (http://localhost:6333/dashboard)
- [ ] ç¯å¢ƒå˜é‡å·²é…ç½® (`backend/.env`)
- [ ] æ•°æ®åº“è¡¨å·²åˆ›å»º (`python backend/db/init_db.py`)

---

## ğŸ¯ ä¸‹ä¸€æ­¥ä¼˜åŒ–å»ºè®®

### ç«‹å³å¯åš:
1. **å‰ç«¯ä½“éªŒä¼˜åŒ–**
   - æ•°æ®é›†å¡ç‰‡æ ·å¼ä¼˜åŒ–
   - ä¸Šä¼ è¿›åº¦åŠ¨ç”»
   - æ‹–æ‹½ä¸Šä¼ æ”¯æŒ

2. **æŸ¥è¯¢å¢å¼º**
   - åœ¨è¾“å…¥æ¡†æ˜¾ç¤ºå½“å‰é€‰ä¸­çš„æ•°æ®é›†
   - æ”¯æŒå¤šæ•°æ®é›†è”åˆæŸ¥è¯¢

### çŸ­æœŸä¼˜åŒ–:
3. **NLâ†’SQL æ”¹è¿›**
   - ä½¿ç”¨ LLM ç”ŸæˆåŠ¨æ€ SQLï¼ˆæ›¿æ¢æ¨¡æ¿ï¼‰
   - æ”¯æŒå¤æ‚èšåˆå’Œ JOIN

4. **é”™è¯¯å¤„ç†**
   - æ›´å‹å¥½çš„é”™è¯¯æç¤º
   - å¤±è´¥é‡è¯•æœºåˆ¶

### ä¸­æœŸä¼˜åŒ–:
5. **æ•°æ®è´¨é‡**
   - æ•°æ®é¢„è§ˆåŠŸèƒ½
   - åˆ—ç±»å‹è‡ªåŠ¨æ¨æ–­ä¼˜åŒ–
   - æ•°æ®æ¸…æ´—å»ºè®®

6. **æ€§èƒ½ä¼˜åŒ–**
   - å¤§æ–‡ä»¶åˆ†å—ä¸Šä¼ 
   - Embedding æ‰¹å¤„ç†
   - æŸ¥è¯¢ç»“æœç¼“å­˜

---

## ğŸ“ API ç«¯ç‚¹æ€»ç»“

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ |
|-----|------|-----|
| `/api/upload_dataset` | POST | ä¸Šä¼ æ–‡ä»¶ |
| `/api/dataset/{id}/status` | GET | æŸ¥è¯¢è§£æçŠ¶æ€ |
| `/api/datasets` | GET | è·å–æ•°æ®é›†åˆ—è¡¨ |
| `/api/dataset/{id}` | DELETE | åˆ é™¤æ•°æ®é›† |
| `/api/generate_chart` | POST | ç”Ÿæˆå›¾è¡¨ï¼ˆæ”¯æŒåŠ¨æ€æ•°æ®é›†ï¼‰ |

---

**æµ‹è¯•å®Œæˆåè¯·åé¦ˆ:**
- âœ… å“ªäº›åŠŸèƒ½æ­£å¸¸
- âŒ é‡åˆ°ä»€ä¹ˆé—®é¢˜
- ğŸ’¡ æœ‰ä»€ä¹ˆæ”¹è¿›å»ºè®®

ç¥æµ‹è¯•é¡ºåˆ©ï¼ğŸš€
