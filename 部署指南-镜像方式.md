# æœåŠ¡å™¨éƒ¨ç½²æŒ‡å— - é•œåƒæ–¹å¼

## ğŸ“‹ éƒ¨ç½²æµç¨‹æ¦‚è§ˆ

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨ä½¿ç”¨Dockeré•œåƒæ–¹å¼éƒ¨ç½²ChatBIç³»ç»Ÿã€‚

**âš ï¸ æ³¨æ„ï¼š** æ•°æ®çˆ¬å–åŠŸèƒ½ï¼ˆCrawlerï¼‰åœ¨ç”Ÿäº§ç¯å¢ƒå·²ç¦ç”¨ï¼Œå‰ç«¯å…¥å£å·²éšè—ï¼Œä½†ä»£ç ä¿ç•™ä»¥ä¾¿åç»­å¯ç”¨ã€‚

**éƒ¨ç½²æµç¨‹ï¼š**
1. åœ¨æœ¬åœ°æ„å»ºDockeré•œåƒï¼ˆä»…ChatBIå‰ç«¯å’Œåç«¯ï¼‰
2. å¯¼å‡ºé•œåƒä¸ºæ–‡ä»¶
3. ä¸Šä¼ é•œåƒåˆ°æœåŠ¡å™¨
4. åœ¨æœåŠ¡å™¨å¯¼å…¥é•œåƒå¹¶å¯åŠ¨æœåŠ¡

---

## ğŸš€ æ­¥éª¤1ï¼šåœ¨æœ¬åœ°æ„å»ºé•œåƒ

### 1.1 ç¡®ä¿Docker Desktopè¿è¡Œ

```bash
# éªŒè¯Dockeræ˜¯å¦è¿è¡Œ
docker ps
```

### 1.2 æ„å»ºChatBIåç«¯é•œåƒ

```bash
cd C:\Users\KC\Desktop\POC\Chat-BI-main\backend
docker build -t chatbi-backend:latest .
```

**é¢„æœŸè¾“å‡ºï¼š**
```
Successfully built xxxxxx
Successfully tagged chatbi-backend:latest
```

### 1.3 æ„å»ºChatBIå‰ç«¯é•œåƒï¼ˆå…ˆç”¨localhostï¼‰

```bash
cd C:\Users\KC\Desktop\POC\Chat-BI-main\frontend
docker build --build-arg VITE_API_BASE_URL=http://localhost:11434 -t chatbi-frontend:latest .
```

**âš ï¸ æ³¨æ„ï¼š** 
- å‰ç«¯é•œåƒå…ˆç”¨localhostæ„å»ºï¼Œç­‰æœ‰æœåŠ¡å™¨åœ°å€åéœ€è¦é‡æ–°æ„å»º
- æ•°æ®çˆ¬å–åŠŸèƒ½å·²ç¦ç”¨ï¼Œä¸éœ€è¦æ„å»ºCrawleråç«¯é•œåƒ

### 1.4 éªŒè¯é•œåƒæ„å»ºæˆåŠŸ

```bash
docker images | findstr chatbi
```

åº”è¯¥çœ‹åˆ°ä¸¤ä¸ªé•œåƒï¼š
```
chatbi-backend   latest   ...
chatbi-frontend  latest   ...
```

---

## ğŸ“¦ æ­¥éª¤2ï¼šå¯¼å‡ºé•œåƒä¸ºæ–‡ä»¶

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
cd C:\Users\KC\Desktop\POC

# å¯¼å‡ºä¸¤ä¸ªé•œåƒï¼ˆCrawlerå·²ç¦ç”¨ï¼‰
docker save chatbi-backend:latest -o chatbi-backend.tar
docker save chatbi-frontend:latest -o chatbi-frontend.tar

# æŸ¥çœ‹æ–‡ä»¶å¤§å°ï¼ˆé•œåƒæ–‡ä»¶å¯èƒ½æ¯”è¾ƒå¤§ï¼Œ1-3GBæ¯ä¸ªï¼‰
dir *.tar
```

**æ–‡ä»¶ä½ç½®ï¼š**
- `C:\Users\KC\Desktop\POC\chatbi-backend.tar`
- `C:\Users\KC\Desktop\POC\chatbi-frontend.tar`

---

## ğŸ“¤ æ­¥éª¤3ï¼šä¸Šä¼ é•œåƒåˆ°æœåŠ¡å™¨

### æ–¹æ³•1ï¼šä½¿ç”¨scpï¼ˆæ¨èï¼‰

```bash
# åœ¨PowerShellä¸­æ‰§è¡Œï¼ˆæ›¿æ¢usernameå’ŒæœåŠ¡å™¨IPï¼‰
scp chatbi-backend.tar username@æœåŠ¡å™¨IP:/home/username/
scp chatbi-frontend.tar username@æœåŠ¡å™¨IP:/home/username/
```

### æ–¹æ³•2ï¼šä½¿ç”¨FTPå·¥å…·

ä½¿ç”¨FileZillaã€WinSCPç­‰å·¥å…·ï¼Œå°†ä¸¤ä¸ª`.tar`æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„`/home/username/`ç›®å½•ã€‚

---

## ğŸ–¥ï¸ æ­¥éª¤4ï¼šåœ¨æœåŠ¡å™¨ä¸Šå¯¼å…¥é•œåƒ

SSHè¿æ¥åˆ°æœåŠ¡å™¨ï¼Œæ‰§è¡Œï¼š

```bash
# 1. è¿›å…¥ä¸Šä¼ ç›®å½•
cd /home/username

# 2. å¯¼å…¥ä¸¤ä¸ªé•œåƒï¼ˆCrawlerå·²ç¦ç”¨ï¼‰
docker load -i chatbi-backend.tar
docker load -i chatbi-frontend.tar

# 3. éªŒè¯é•œåƒå·²å¯¼å…¥
docker images | grep chatbi
```

**é¢„æœŸè¾“å‡ºï¼š**
```
chatbi-backend   latest   ...
chatbi-frontend  latest   ...
```

---

## âš™ï¸ æ­¥éª¤5ï¼šé…ç½®docker-composeæ–‡ä»¶

### 5.1 åˆ›å»ºé¡¹ç›®ç›®å½•

```bash
mkdir -p /home/username/chatbi-prod
cd /home/username/chatbi-prod
```

### 5.2 åˆ›å»ºdocker-compose.prod.yml

å°†é¡¹ç›®æ ¹ç›®å½•çš„`docker-compose.prod.yml`æ–‡ä»¶å¤åˆ¶åˆ°æœåŠ¡å™¨ï¼Œæˆ–ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºï¼š

```bash
# ä½¿ç”¨nanoç¼–è¾‘å™¨åˆ›å»ºæ–‡ä»¶
nano docker-compose.prod.yml
```

**âš ï¸ é‡è¦ï¼š** å¿…é¡»ä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š

1. **æ•°æ®åº“å¯†ç **ï¼š`POSTGRES_PASSWORD` å’Œ `DBPGPASSWORD`
2. **MinIOå¯†ç **ï¼š`MINIO_ROOT_USER` å’Œ `MINIO_ROOT_PASSWORD`
3. **APIå¯†é’¥**ï¼š`OPENAI_API_KEY`
4. **Secret Key**ï¼š`SECRET_KEY`
5. **æœåŠ¡å™¨IP**ï¼š`FRONTEND_URL`ï¼ˆæ›¿æ¢ä¸ºå®é™…æœåŠ¡å™¨IPæˆ–åŸŸåï¼‰

### 5.3 åˆ›å»ºæ—¥å¿—ç›®å½•

```bash
mkdir -p logs
```

---

## ğŸš€ æ­¥éª¤6ï¼šå¯åŠ¨æ‰€æœ‰æœåŠ¡

```bash
# 1. å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose -f docker-compose.prod.yml up -d

# 2. æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose -f docker-compose.prod.yml ps

# åº”è¯¥çœ‹åˆ°6ä¸ªæœåŠ¡å…¨éƒ¨è¿è¡Œï¼š
# - chatbi-postgres-prod
# - chatbi-redis-prod
# - chatbi-minio-prod
# - chatbi-qdrant-prod
# - chatbi-backend-prod
# - chatbi-frontend-prod
# æ³¨æ„ï¼šcrawler-backend-prod å·²ç¦ç”¨
```

### 6.1 æŸ¥çœ‹æ—¥å¿—ï¼ˆå¦‚æœæœ‰é—®é¢˜ï¼‰

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs -f

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs -f chatbi-backend
docker-compose -f docker-compose.prod.yml logs -f chatbi-frontend
```

---

## ğŸ—„ï¸ æ­¥éª¤7ï¼šåˆå§‹åŒ–æ•°æ®åº“

```bash
# ç­‰å¾…æ•°æ®åº“æœåŠ¡å°±ç»ªï¼ˆçº¦30ç§’ï¼‰
sleep 30

# è¿›å…¥ChatBIåç«¯å®¹å™¨
docker exec -it chatbi-backend-prod bash

# åœ¨å®¹å™¨å†…æ‰§è¡Œåˆå§‹åŒ–
export PYTHONPATH=/app
python db/init_db.py

# é€€å‡ºå®¹å™¨
exit
```

**é¢„æœŸè¾“å‡ºï¼š**
```
æ•°æ®åº“å·²åˆå§‹åŒ–ï¼Œç°æœ‰ X ä¸ªè¡¨
ç®¡ç†å‘˜è´¦æˆ·å·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º
```

---

## âœ… æ­¥éª¤8ï¼šéªŒè¯éƒ¨ç½²

### 8.1 æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨çŠ¶æ€
docker-compose -f docker-compose.prod.yml ps

# æ‰€æœ‰æœåŠ¡åº”è¯¥æ˜¾ç¤º "Up" çŠ¶æ€
```

### 8.2 è®¿é—®ç³»ç»Ÿ

- **å‰ç«¯ç•Œé¢**ï¼š`http://æœåŠ¡å™¨IP` æˆ– `http://æœåŠ¡å™¨IP:80`
- **ChatBIåç«¯API**ï¼š`http://æœåŠ¡å™¨IP:11434`
- **ChatBI APIæ–‡æ¡£**ï¼š`http://æœåŠ¡å™¨IP:11434/docs`
- **MinIOæ§åˆ¶å°**ï¼š`http://æœåŠ¡å™¨IP:9001`

**æ³¨æ„ï¼š** æ•°æ®çˆ¬å–åŠŸèƒ½ï¼ˆCrawlerï¼‰å·²ç¦ç”¨ï¼Œç›¸å…³APIä¸å¯ç”¨ã€‚

### 8.3 æµ‹è¯•API

```bash
# æµ‹è¯•ChatBIåç«¯
curl http://æœåŠ¡å™¨IP:11434/api/ai-model-configs?user_id=1
```

---

## ğŸ”„ æ­¥éª¤9ï¼šæ›´æ–°å‰ç«¯é•œåƒï¼ˆç­‰æœ‰æœåŠ¡å™¨åœ°å€åï¼‰

### 9.1 é‡æ–°æ„å»ºå‰ç«¯é•œåƒï¼ˆåœ¨æœ¬åœ°ï¼‰

```bash
cd C:\Users\KC\Desktop\POC\Chat-BI-main\frontend

# æ›¿æ¢ä¸ºå®é™…æœåŠ¡å™¨IPï¼ˆä¾‹å¦‚ï¼š192.168.1.100ï¼‰
# æ³¨æ„ï¼šVITE_CRAWLER_API_BASE_URL å·²ç¦ç”¨
docker build --build-arg VITE_API_BASE_URL=http://å®é™…æœåŠ¡å™¨IP:11434 -t chatbi-frontend:latest .

# é‡æ–°å¯¼å‡º
docker save chatbi-frontend:latest -o chatbi-frontend.tar
```

### 9.2 ä¸Šä¼ æ–°é•œåƒåˆ°æœåŠ¡å™¨

```bash
scp chatbi-frontend.tar username@æœåŠ¡å™¨IP:/home/username/
```

### 9.3 åœ¨æœåŠ¡å™¨ä¸Šæ›´æ–°

```bash
# 1. å¯¼å…¥æ–°é•œåƒ
docker load -i chatbi-frontend.tar

# 2. åœæ­¢å¹¶åˆ é™¤æ—§å®¹å™¨
docker-compose -f docker-compose.prod.yml stop chatbi-frontend
docker-compose -f docker-compose.prod.yml rm -f chatbi-frontend

# 3. å¯åŠ¨æ–°å®¹å™¨
docker-compose -f docker-compose.prod.yml up -d chatbi-frontend
```

---

## ğŸ› ï¸ å¸¸ç”¨ç®¡ç†å‘½ä»¤

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```bash
docker-compose -f docker-compose.prod.yml ps
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# æ‰€æœ‰æœåŠ¡
docker-compose -f docker-compose.prod.yml logs -f

# ç‰¹å®šæœåŠ¡
docker-compose -f docker-compose.prod.yml logs -f chatbi-backend
```

### é‡å¯æœåŠ¡

```bash
# é‡å¯æ‰€æœ‰æœåŠ¡
docker-compose -f docker-compose.prod.yml restart

# é‡å¯ç‰¹å®šæœåŠ¡
docker-compose -f docker-compose.prod.yml restart chatbi-backend
```

### åœæ­¢æœåŠ¡

```bash
docker-compose -f docker-compose.prod.yml stop
```

### å¯åŠ¨æœåŠ¡

```bash
docker-compose -f docker-compose.prod.yml start
```

### åœæ­¢å¹¶åˆ é™¤æ‰€æœ‰å®¹å™¨

```bash
docker-compose -f docker-compose.prod.yml down
```

### åœæ­¢å¹¶åˆ é™¤æ‰€æœ‰å®¹å™¨å’Œæ•°æ®å·ï¼ˆâš ï¸ å±é™©ï¼ä¼šåˆ é™¤æ•°æ®ï¼‰

```bash
docker-compose -f docker-compose.prod.yml down -v
```

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šå®¹å™¨æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs æœåŠ¡å

# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps -a | grep æœåŠ¡å
```

### é—®é¢˜2ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥æ•°æ®åº“å®¹å™¨æ˜¯å¦è¿è¡Œ
docker ps | grep postgres

# æ£€æŸ¥æ•°æ®åº“æ—¥å¿—
docker logs chatbi-postgres-prod

# è¿›å…¥æ•°æ®åº“å®¹å™¨æµ‹è¯•è¿æ¥
docker exec -it chatbi-postgres-prod psql -U aigcgen -d chabi_template
```

### é—®é¢˜3ï¼šå‰ç«¯æ— æ³•è¿æ¥åç«¯

- æ£€æŸ¥å‰ç«¯é•œåƒæ„å»ºæ—¶ä½¿ç”¨çš„APIåœ°å€æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥æœåŠ¡å™¨é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ç«¯å£
- æ£€æŸ¥docker-composeä¸­çš„æœåŠ¡ä¾èµ–å…³ç³»

### é—®é¢˜4ï¼šç«¯å£è¢«å ç”¨

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tulpn | grep 11434
netstat -tulpn | grep 8001
netstat -tulpn | grep 80

# ä¿®æ”¹docker-compose.prod.ymlä¸­çš„ç«¯å£æ˜ å°„
```

---

## ğŸ“ æ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰ç¡®è®¤ï¼š

- [ ] Docker Desktopå·²å®‰è£…å¹¶è¿è¡Œ
- [ ] ä¸¤ä¸ªé•œåƒå·²æˆåŠŸæ„å»ºï¼ˆChatBIå‰ç«¯å’Œåç«¯ï¼‰
- [ ] é•œåƒæ–‡ä»¶å·²å¯¼å‡ºä¸º.taræ–‡ä»¶
- [ ] é•œåƒæ–‡ä»¶å·²ä¸Šä¼ åˆ°æœåŠ¡å™¨
- [ ] æœåŠ¡å™¨ä¸Šé•œåƒå·²æˆåŠŸå¯¼å…¥
- [ ] docker-compose.prod.ymlå·²åˆ›å»ºå¹¶ä¿®æ”¹äº†æ‰€æœ‰å¯†ç 
- [ ] æ•°æ®åº“å·²åˆå§‹åŒ–
- [ ] æ‰€æœ‰æœåŠ¡æ­£å¸¸è¿è¡Œ
- [ ] å‰ç«¯å¯ä»¥è®¿é—®
- [ ] åç«¯APIå¯ä»¥è®¿é—®

---

## ğŸ‰ å®Œæˆï¼

ç°åœ¨æ‚¨çš„å®Œæ•´ç³»ç»Ÿå·²éƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼ŒåŒ…æ‹¬ï¼š

- âœ… ChatBIå‰ç«¯ï¼ˆç«¯å£80ï¼‰
- âœ… ChatBIåç«¯ï¼ˆç«¯å£11434ï¼‰
- âš ï¸ Crawleråç«¯ï¼ˆå·²ç¦ç”¨ï¼Œä¸éƒ¨ç½²ï¼‰
- âœ… PostgreSQLæ•°æ®åº“
- âœ… Redisç¼“å­˜
- âœ… MinIOå¯¹è±¡å­˜å‚¨
- âœ… Qdrantå‘é‡æ•°æ®åº“

**ç¥éƒ¨ç½²é¡ºåˆ©ï¼** ğŸš€

